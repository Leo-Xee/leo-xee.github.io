{"componentChunkName":"component---src-templates-blog-post-js","path":"/React/react-query-basic/","result":{"data":{"site":{"siteMetadata":{"title":"leo-xee.io","author":"Leo-Xee","siteUrl":"https://leo-xee.github.io","comment":{"disqusShortName":"","utterances":"leo-xee/blog-comments"},"sponsor":{"buyMeACoffeeId":"leoxexe"}}},"markdownRemark":{"id":"ed94b444-36ec-5003-8e92-8d1eff0b73ea","excerpt":"React Query란?  React-Query는 데이터 패칭, 캐싱, 업데이트, 동기화와 같은 서버 상태를 관리해주는 React 라이브러리이다. 기존에는 Redux와 같은 전역 상태 관리 라이브러리에서 클라이언트 상태뿐만 아니라 서버 상태까지 관리하고 있어서 로직이 복잡해지는 문제가 있었다. 이를 해결하기 위해 등장한 것이 서버 상태 관리 라이브러리이며 대표적으로 React-Query가 사용된다. 이 외에도 SWR, RTK Query가 있다. 설치 및 세팅 Next.js에서 React-Query…","html":"<p><img src=\"/8cb1d8c731f6ada9d4ed8649b2e7cc6a/React.gif\"></p>\n<h1 id=\"react-query란\" style=\"position:relative;\"><a href=\"#react-query%EB%9E%80\" aria-label=\"react query란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React Query란?</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 771px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABaklEQVQoz4VRS0sCURj1J7UqaiG4bJe7Vm2iFtUiN9WiKKSnLcQSkoLB2lTSkIsIolyEDD0WYYUMio09tKxR0Upq9I6nO86M1GjjgY8793x3zj3fPRY0QbVaVVdZbuxpnH7GCAv+gUzUH/kQh9vgCbitfbwl7tVek4tMBZXbFSeEfrMj01jtssHXZsUZFa31CTF3WB9REaIlV0htf7XJItDejeE5O8YcPWA77BBu+D8TtBRUxiFEFRTzBez1OeC0WeHptOJieR2S5l45J2sGfmtYjEEYEWMPcepicDzpRjoah1mIdUFZI5LpDBaZALhIFImnZwi0OCpynkhiJ3yJMOUzYg6R2B2u4wJSr1l8S+VGh3pqvPCIAacHQ/NeDNK1f8aNJWYX/uARprx+jLp8mFhh0Du+gLXAAWY3tvElSY2C+obQhy7TQIqfJeQK77UqfpRQoVwmm8eLmK9zirP4Q6r5yGZv2ArGUH4AVIvnuiyQvroAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"그림. react-query logo\"\n        title=\"그림. react-query logo\"\n        src=\"/static/30b6b2c49b2314926e2ff64bff8a3fb7/5d030/react-query-basic-01.png\"\n        srcset=\"/static/30b6b2c49b2314926e2ff64bff8a3fb7/5a46d/react-query-basic-01.png 300w,\n/static/30b6b2c49b2314926e2ff64bff8a3fb7/0a47e/react-query-basic-01.png 600w,\n/static/30b6b2c49b2314926e2ff64bff8a3fb7/5d030/react-query-basic-01.png 771w\"\n        sizes=\"(max-width: 771px) 100vw, 771px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><strong>React-Query는 데이터 패칭, 캐싱, 업데이트, 동기화와 같은 서버 상태를 관리해주는 React 라이브러리이다.</strong> 기존에는 Redux와 같은 전역 상태 관리 라이브러리에서 클라이언트 상태뿐만 아니라 서버 상태까지 관리하고 있어서 로직이 복잡해지는 문제가 있었다. 이를 해결하기 위해 등장한 것이 서버 상태 관리 라이브러리이며 대표적으로 React-Query가 사용된다. 이 외에도 SWR, RTK Query가 있다.</p>\n<h1 id=\"설치-및-세팅\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%84%B8%ED%8C%85\" aria-label=\"설치 및 세팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치 및 세팅</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> react-query</code></pre></div>\n<p>Next.js에서 React-Query를 사용하기 위해서는 <code class=\"language-text\">pages/_app.tsx</code> 에서 <code class=\"language-text\">Context Provider</code>로 <code class=\"language-text\">QueryClient</code> 를 다음과 같이 전달해줘야한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppProps <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/app'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> QueryClientProvider<span class=\"token punctuation\">,</span> QueryClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-query'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ReactQueryDevtools <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-query/devtools'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> AppProps</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">QueryClientProvider</span></span> <span class=\"token attr-name\">client</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>queryClient<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Component</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ReactQueryDevtools</span></span> <span class=\"token attr-name\">initialIsOpen</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">QueryClientProvider</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> MyApp</code></pre></div>\n<h1 id=\"사용\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9\" aria-label=\"사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용</h1>\n<h2 id=\"usequery\" style=\"position:relative;\"><a href=\"#usequery\" aria-label=\"usequery permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useQuery</h2>\n<p>useQuery는 데이터를 GET하기 위해 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 기본 구조</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> isLoading<span class=\"token punctuation\">,</span> isError<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>queryKey<span class=\"token punctuation\">,</span> queryFn<span class=\"token punctuation\">,</span> optionObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// queryKey로 문자열을 받는 경우의 예시</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/carts\"</span><span class=\"token punctuation\">,</span> getCarts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// queryKey로 배열을 받는 경우의 예시</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"/orders\"</span><span class=\"token punctuation\">,</span> orderId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getOrder</span><span class=\"token punctuation\">(</span>orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// select 옵션을 사용해서 데이터를 filter하는 예시</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/carts\"</span><span class=\"token punctuation\">,</span> getCarts<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">select</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">carts</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> carts<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cart</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> cart<span class=\"token punctuation\">.</span>product<span class=\"token punctuation\">.</span>selected<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>\n<p><strong><code class=\"language-text\">queryKey</code></strong></p>\n<ul>\n<li>데이터를 GET하는 요청들을 구분하는 Key값을 받으며 이는 해시화되어 관리된다.</li>\n<li>useQuery는 Key값을 기반으로 캐싱을 하기 떄문에 Key값이 동일하면 다른 데이터에 대한 요청일지라도 같은 요청으로 인식하고 캐시를 관리한다.</li>\n<li>타입으로는 문자열이나 배열을 받는다.</li>\n</ul>\n</li>\n<li>\n<p><strong><code class=\"language-text\">queryFn</code></strong></p>\n<ul>\n<li>GET 요청에 사용할 비동기함수를 받는다.</li>\n<li>인자가 필요한 비동기함수일 경우에는 함수 호출문을 넣지않도록 주의해야한다.</li>\n</ul>\n</li>\n<li>\n<p><strong><code class=\"language-text\">OptionObj</code></strong></p>\n<ul>\n<li>useQuery에서 사용할 옵션 객체를 받으며 주로 사용되는 옵션은 다음과 같다.</li>\n<li><code class=\"language-text\">onSuccess</code>, <code class=\"language-text\">onError</code>, <code class=\"language-text\">onSettled</code>: 성공, 실패, 완료 시에 실행할 Side Effect를 정의</li>\n<li><code class=\"language-text\">enabled</code>: 자동으로 query를 실행할지 말지 여부를 지정</li>\n<li><code class=\"language-text\">retry</code>: query 요청 실패 시에 자동으로 재시도할지 결정</li>\n<li><code class=\"language-text\">select</code>: 요청을 성공한 데이터를 가공해서 전달</li>\n<li><code class=\"language-text\">keepPreviousData</code>: 새로운 데이터 fetching할 때 이전의 데이터를 유지</li>\n<li><code class=\"language-text\">refetchInterval</code>: 주기적으로 refetch할지를 결정</li>\n<li><code class=\"language-text\">refetchOnWindowFocus</code>: 브라우저가 다시 포커스 되었을 때 실행할지 말지 여부 지정</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"usemutation\" style=\"position:relative;\"><a href=\"#usemutation\" aria-label=\"usemutation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useMutation</h2>\n<p>useMutation은 데이터를 POST, PUT, PATCH, DELETE하기 위해 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 기본 구조</span>\n<span class=\"token keyword\">const</span> mutation <span class=\"token operator\">=</span> <span class=\"token function\">useMutation</span><span class=\"token punctuation\">(</span>mutationFn<span class=\"token punctuation\">,</span> optionObj<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 선언 예시</span>\n<span class=\"token keyword\">const</span> addCartMutation <span class=\"token operator\">=</span> <span class=\"token function\">useMutation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">product<span class=\"token operator\">:</span> Product</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">addCart</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 실행 예시</span>\naddCartMutation<span class=\"token punctuation\">.</span><span class=\"token function\">mutate</span><span class=\"token punctuation\">(</span>products<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">mutationFn</code></p>\n<ul>\n<li>POST, PUT, PATCH, DELETE 요청을 수행할 비동기 함수를 받는다.</li>\n<li>useMutation을 실행하기 위해서는 반환 객체의 메소드인 <code class=\"language-text\">mutate</code>를 사용해야한다.</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">optionObj</code></p>\n<ul>\n<li>useMutation에서 사용할 옵션 객체를 받는다.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"invalidatequeries\" style=\"position:relative;\"><a href=\"#invalidatequeries\" aria-label=\"invalidatequeries permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>InvalidateQueries</h2>\n<p><strong>useMutation으로 서버의 데이터가 변경되었다면 기존의 useQuery로 GET한 데이터는 일반적으로 stale한 상태가 된다.</strong> 이 때 캐시에서 기존의 데이터를 폐기하고 데이터를 다시 불러올 때 <code class=\"language-text\">InvalidateQueryies</code> 메소드가 사용된다.</p>\n<blockquote>\n<p>여기서 stale은 상한, 썩은 의미를 가진 단어로 React-Query에서는 더이상 유효하지 않은 데이터를 칭할 때 주로 사용한다.</p>\n</blockquote>\n<br>\n<p>이는 위에서 작성한 useMutation 예시의 경우에 데이터 변경에 대한 요청은 성공적으로 완료되지만 동일한 데이터를 GET하는 useQuery는 여전히 이전의 데이터를 보여주고 있음을 의미한다.</p>\n<p>그렇다면 Mutation 요청이 성공했을 때 useQuery가 데이터를 다시 불러오도록 수정하면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useMutation<span class=\"token punctuation\">,</span> useQueryClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-query'</span>\n에\n<span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token function\">useQueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> addCartMutation <span class=\"token operator\">=</span> <span class=\"token function\">useMutation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">product<span class=\"token operator\">:</span> Product</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">addCart</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 성공 시에 queryKey가 \"/carts\"인 useQuery의 캐시 초기화 및 재실행</span>\n  <span class=\"token function-variable function\">onSuccess</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">invalidateQueries</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/carts'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">InvalidateQueries</code> 메소드는 <code class=\"language-text\">useQueryClient</code>의 반환 객체에 포함되어 있다.</li>\n</ul>\n<br>\n<p>지금까지는 CSR(Client Side Rendering)을 전제로 React-Query를 사용하는 기본적인 방법을 살펴봤다. 그렇다면 SSR(Server Side Rendering)의 경우에는 어떻게 사용할까?</p>\n<h1 id=\"nextjs의-ssr에-적용\" style=\"position:relative;\"><a href=\"#nextjs%EC%9D%98-ssr%EC%97%90-%EC%A0%81%EC%9A%A9\" aria-label=\"nextjs의 ssr에 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next.js의 SSR에 적용</h1>\n<p><strong>React-Query는 친절하게도 Next.js 기반의 SSR에서도 사용할 수 있도록 크게 2가지 방법을 제공한다.</strong> 첫 번째는 <code class=\"language-text\">InitialData</code>를 사용하는 방법이고 두 번째는 <code class=\"language-text\">Hydration</code>을 사용하는 방법이다. 여기서는 일반적으로 사용되는 두 번째 방법에 대해서 정리한다</p>\n<h2 id=\"세팅-추가\" style=\"position:relative;\"><a href=\"#%EC%84%B8%ED%8C%85-%EC%B6%94%EA%B0%80\" aria-label=\"세팅 추가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세팅 추가</h2>\n<p>이를 위해서는 <code class=\"language-text\">pages/_app.tsx</code>에 추가적인 세팅을 다음과 같이 해줘야한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppProps <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/app'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> QueryClientProvider<span class=\"token punctuation\">,</span> QueryClient<span class=\"token punctuation\">,</span> Hydrate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-query'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ReactQueryDevtools <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-query/devtools'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> AppProps</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>queryClient<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">QueryClientProvider</span></span> <span class=\"token attr-name\">client</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>queryClient<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Hydrate</span></span> <span class=\"token attr-name\">state</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>pageProps<span class=\"token punctuation\">.</span>dehydratedState<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Component</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Hydrate</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ReactQueryDevtools</span></span> <span class=\"token attr-name\">initialIsOpen</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">QueryClientProvider</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> MyApp</code></pre></div>\n<h2 id=\"사용-1\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9-1\" aria-label=\"사용 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용</h2>\n<p>그 다음, 페이지 컴포넌트의 <code class=\"language-text\">GetServerSideProps</code>의 내부에 다음과 같이 작성해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> GetServerSideProps <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> dehydrate<span class=\"token punctuation\">,</span> QueryClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-query'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">CartPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> getServerSideProps<span class=\"token operator\">:</span> <span class=\"token function-variable function\">GetServerSideProps</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">await</span> queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">prefetchQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/carts'</span><span class=\"token punctuation\">,</span> getCarts<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      dehydratedState<span class=\"token operator\">:</span> <span class=\"token function\">dehydrate</span><span class=\"token punctuation\">(</span>queryClient<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 해당 페이지 컴포넌트 내부에서 사용되는 <code class=\"language-text\">useQuery('/carts', getCarts)</code>는 SSR에서 정상적으로 실행된다.</p>\n<h1 id=\"참조\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EC%A1%B0\" aria-label=\"참조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참조</h1>\n<ul>\n<li><a href=\"https://react-query.tanstack.com\">https://react-query.tanstack.com</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=MArE6Hy371c\">https://www.youtube.com/watch?v=MArE6Hy371c</a></li>\n<li><a href=\"https://github.com/Leo-Xee/next-shopping-cart\">https://github.com/Leo-Xee/next-shopping-cart</a></li>\n</ul>","frontmatter":{"title":"React-Query","date":"May 27, 2022"}}},"pageContext":{"slug":"/React/react-query-basic/","previous":{"fields":{"slug":"/Error/eslint-label/"},"frontmatter":{"title":"Error: A form label must be associated with a control."}},"next":{"fields":{"slug":"/Error/next-window/"},"frontmatter":{"title":"Error: Hydration failed because the initial UI does not match what was rendered on the server."}}}}}