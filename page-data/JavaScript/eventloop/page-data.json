{"componentChunkName":"component---src-templates-blog-post-js","path":"/JavaScript/eventloop/","result":{"data":{"site":{"siteMetadata":{"title":"leo-xee.io","author":"Leo-Xee","siteUrl":"https://leo-xee.github.io","comment":{"disqusShortName":"","utterances":"leo-xee/blog-comments"},"sponsor":{"buyMeACoffeeId":"leoxexe"}}},"markdownRemark":{"id":"f074390d-edd8-5147-9ea9-904a34b9eef2","excerpt":"이벤트 루프란? 자바스크립트는 싱글 스레드 언어이다. 싱글 스레드의 의미는 작업을 하나씩만 수행할 수 있고 다수의 작업을 동시에 수행하는 것은 불가능하다는 것을 말한다. 하지만 브라우저가 동작하는 것을 살펴보면 많은 작업들이 동시에 실행되는 것처럼 보인다. 이를 가능하게 해주는 것이 이벤트 루프(Event Loop)이며 이벤트 루프는 자바스크립트에게 동시성을 지원해준다. 하지만 여기서 확실히 짚고가야할 부분은 이벤트 루프가 ECMAScript…","html":"<p><img src=\"/b6422d8815031d57cf3948e4032caf37/thumbNail.gif\"></p>\n<h1 id=\"이벤트-루프란\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84%EB%9E%80\" aria-label=\"이벤트 루프란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이벤트 루프란?</h1>\n<p><strong>자바스크립트는 싱글 스레드 언어이다.</strong> 싱글 스레드의 의미는 작업을 하나씩만 수행할 수 있고 다수의 작업을 동시에 수행하는 것은 불가능하다는 것을 말한다. 하지만 브라우저가 동작하는 것을 살펴보면 많은 작업들이 동시에 실행되는 것처럼 보인다. 이를 가능하게 해주는 것이 <strong>이벤트 루프(Event Loop)이며 이벤트 루프는 자바스크립트에게 동시성을 지원해준다.</strong></p>\n<p>하지만 여기서 확실히 짚고가야할 부분은 이벤트 루프가 ECMAScript에 명세되어 있는 개념이 아니라는 것이다. 즉, <strong>이벤트 루프는 자바스크립트를 구동하는 환경인 브라우저나 Node.js에서 제공하는 다양한 기능 중 하나이다.</strong></p>\n<h1 id=\"동작-원리\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC\" aria-label=\"동작 원리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동작 원리</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 700px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACmklEQVQ4y5VUTY/SUBTtz/A/ufEHuNCdJiYuxmhcaKImxjFx47h1O4sxceEkKh+GkQEKpQWmzCgz4BAi8jHQ8lpomQ7wju++UpSMG29yc8vt63nnnXMfCv4jOOdrz9FPqosFlz1lNpuBMSbSgeM4skbpOGzZY6B1f4Ai4IXI2bKGoRSLRWQyGVQqFRhGCaWSgYMDQ9ZSqYRyuYxCoSBTQizoYw7mcvxoOjAPf6HZctEbLOD5CyiapsHzvNUOgb2NztEdUXfWjqeq6trxX2wxXLvZx427A5lXr/eQTPtQdF2XR4vitLyBrWdXcKw/XDKaIwgC0MaWZcE0q+h2fuL9x3M82rTx/DXD5huGxy9HKB8G4ZFJpyg86zOGzVfw7eSqd3FxgXw+L5lOp+dSt7fbY9x+MMTGEwv3nlq4dX8IVT+HYhgGhsMhRraFfr8PfxqKPxdStVottNttATJdaRhFRpvi3e4Eu3EPH2KefD5tzaCQ+KlUCnvpLPSCjq97e4JRIDTLgdhT7u/vy3rZ5cuh5PMqEl9S+N4GCqyIWO4T3JErnD5YLcpmsyuGERjN3Xy+nnIOyb0MLe524B7r0I4qcEYMJAVJ0O12iSEnU0K8EJH/g+YKMJvLCRNcYBLArFbBRiOQ+wTW6XSQTqeJIY/mkIchWM25SKpRH0o2p6KoZaCWAeYD3wRDGg9iaNu2NEwAcjo29QVrTq4TIXrX6/VCM30/1FDTQtFrtWM0Gg05HrQjVWIpkhMgbdBsNrlpmpzm8uTkhFPWajXU63VUxcloA4WuF7mcTCYRi8WkAfSSajweRyKRkIAE7rouFyw53WvxMR8MBvzs7EwCkTx04xSiPx6PJWXfn2Iymcg/A6phz5fvxbq/TeDLvBS/AWbYTZbh4uujAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"그림1. 이벤트 루프\"\n        title=\"그림1. 이벤트 루프\"\n        src=\"/static/e60357bf5ee51119e36f5daff577ea76/8c557/eventloop-01.png\"\n        srcset=\"/static/e60357bf5ee51119e36f5daff577ea76/5a46d/eventloop-01.png 300w,\n/static/e60357bf5ee51119e36f5daff577ea76/0a47e/eventloop-01.png 600w,\n/static/e60357bf5ee51119e36f5daff577ea76/8c557/eventloop-01.png 700w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>위 그림은 이벤트 루프를 설명하기 위해서 필요한 브라우저 내부의 요소들이고 자세한 내용은 다음과 같다.</p>\n<ul>\n<li>\n<p><strong>자바스크립트 엔진</strong></p>\n<ul>\n<li>자바스크립트 코드를 실행하는 엔진이며 내부에 콜 스택과 힙이라는 영역을 포함하고 있다. 콜 스택은 전에 <a href=\"https://leo-xee.github.io/JavaScript/execution-context/\">실행 컨텍스트</a>에서 설명했기 때문에 넘어가고 힙은 실행 컨텍스트에서 사용할 변수가 저장되는 메모리 공간으로 이해하면 된다.</li>\n</ul>\n</li>\n<li>\n<p><strong>Web APIs</strong></p>\n<ul>\n<li>브라우저에서 지원하는 API로써 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API\">다양한 작업</a>을 지원한다.</li>\n<li>그 중에 비동기 작업이 필요한 특정 API(DOM API, AJAX, Timer 관련 API)들은 <strong>자바스크립트 엔진과 별개의 스레드에서 동시에 동작하는 백그라운드(Background)라는 영역에서 실행된다.</strong></li>\n</ul>\n</li>\n<li>\n<p><strong>콜백 큐(테스크 큐)</strong></p>\n<ul>\n<li>백그라운드에서 실행이 완료된 Web APIs 의 콜백이 <code class=\"language-text\">push</code> 되는 큐(Queue)이다.</li>\n</ul>\n</li>\n</ul>\n<br>\n<p>기본적인 동작 과정은 다음과 같다.</p>\n<ol>\n<li>자바스크립트 엔진이 자바스크립트 파일을 실행</li>\n<li>백그라운드에서 실행되어야 할 Web API 발견</li>\n<li>해당 API를 백그라운드에서 실행하도록 이동</li>\n<li>자바스크립트 파일 실행 재개 + 백그라운드로 이동된 API도 동시에 실행</li>\n<li>백그라운드의 API가 실행 완료된 후에 콜백이 태스크 큐로 <code class=\"language-text\">push</code></li>\n<li>이벤트 루프가 테스크 큐에 작업이 있다는 것을 감지하고 콜 스택이 비어 있을 때까지 대기</li>\n<li>자바스크립트 파일의 실행이 완료되어 콜 스택이 빔</li>\n<li>이벤트 루프가 콜 스택이 비어있음을 감지하고 테스크 큐의 작업을 콜 스택에 <code class=\"language-text\">push</code></li>\n<li>자바스크립트 엔진이 <code class=\"language-text\">push</code> 된 작업을 실행하고 완료된 후에 전체 작업 종료</li>\n</ol>\n<p>여기서 알 수 있듯이 <strong>이벤트 루프의 역할은 콜 스택과 테스크 큐를 항상 바라보고 있다가 콜 스택이 비어 있으면 테스크 큐에서 대기하고 있는 콜백을 콜 스택으로 이동시켜주는 것이 전부이다.</strong></p>\n<h2 id=\"매크로태스크-큐와-마이크로태스크-큐\" style=\"position:relative;\"><a href=\"#%EB%A7%A4%ED%81%AC%EB%A1%9C%ED%83%9C%EC%8A%A4%ED%81%AC-%ED%81%90%EC%99%80-%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%ED%83%9C%EC%8A%A4%ED%81%AC-%ED%81%90\" aria-label=\"매크로태스크 큐와 마이크로태스크 큐 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>매크로태스크 큐와 마이크로태스크 큐</h2>\n<p><img src=\"/d310c604dac0d56b5f49f618dc524e77/eventloop-02.gif\" alt=\"그림2. 태스크 큐와 마이크로태스크 큐\"></p>\n<p>위에서는 태스크 큐가 하나인 것처럼 동작 과정을 설명했지만 사실 태스크 큐는 다음과 같이 2가지 종류로 나누어진다.</p>\n<ul>\n<li>\n<p><strong>매크로태스크 큐(Macrotask Queue)</strong></p>\n<ul>\n<li>requestAnimationFrame</li>\n<li>I/O (네트워크나 하드웨어 작업)</li>\n<li>UI rendering</li>\n<li>Timer(setTimeout, setInterval, setImmediate)</li>\n</ul>\n</li>\n<li>\n<p><strong>마이크로태스크 큐(Microtask Queue)</strong></p>\n<ul>\n<li>process.nextTick</li>\n<li>Promises</li>\n<li>queueMicrotask</li>\n<li>MutationObserver</li>\n</ul>\n</li>\n</ul>\n<br>\n<p><strong>여기서 중요한 점은 마이크로태스크 큐가 매크로태스크 큐보다 우선순위가 높다는 것이다.</strong></p>\n<h1 id=\"동작-예시\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%9E%91-%EC%98%88%EC%8B%9C\" aria-label=\"동작 예시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동작 예시</h1>\n<p>이제 브라우저가 비동기를 제어하는 과정과 이벤트 루프의 역할도 알아보았다. 그리고 태스크 큐도 매크로태스크 큐와 마이크로태스크 큐로 나눠진다는 사실을 확인했으니 <strong>마지막으로 다음 예시의 동작을 분석해보고 확실하게 정리해보자.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'start'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'setTimeout'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise1'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise2'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">deley</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">deley</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">start\nend\npromise1\npromise2\nsetTimeout</code></pre></div>\n<p>위 예시 코드의 동작 과정은 다음과 같다.</p>\n<ol>\n<li>전역 실행 컨텍스트가 생성되고 콘솔에 <code class=\"language-text\">start</code> 를 출력 (<code class=\"language-text\">console</code>의 실행 과정은 생략)</li>\n<li><code class=\"language-text\">setTimeout</code> 을 백그라운드로 이동</li>\n<li>2개의 <code class=\"language-text\">then</code> 함수가 백그라운드로 이동 <strong>(Promise는 <code class=\"language-text\">then</code>, <code class=\"language-text\">catch</code> 이전까지는 동기적으로 동작)</strong></li>\n<li>delay 실행 컨텍스트가 생성되고 delay 함수를 실행</li>\n<li>백그라운드의 <code class=\"language-text\">setTimeout</code> 과 2개의 <code class=\"language-text\">then</code> 함수의 실행이 완료</li>\n<li><code class=\"language-text\">setTimeout</code> 의 콜백이 매크로태스크 큐로 <code class=\"language-text\">push</code> 되고 대기</li>\n<li>2개의 <code class=\"language-text\">then</code> 의 콜백이 마이크로태스크 큐로 <code class=\"language-text\">push</code> 되고 대기</li>\n<li>delay 함수의 실행이 종료되고 delay의 실행 컨텍스트 소멸</li>\n<li>콘솔에 <code class=\"language-text\">end</code>를 출력한다.</li>\n<li>이벤트 루프가 콜스택이 비었음을 감지</li>\n<li>이벤트 루프가 우선순위가 높은 마이크로태스크 큐의 콜백을 콜 스택으로 이동</li>\n<li><code class=\"language-text\">promise1</code>과 <code class=\"language-text\">promise2</code> 를 출력</li>\n<li>이벤트 루프가 마이크로태스크 큐가 비었음을 확인하고 매크로태스크 큐의 콜백을 콜 스택으로 이동</li>\n<li><code class=\"language-text\">setTimeout</code>을 출력</li>\n</ol>\n<br>\n<h1 id=\"참조\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EC%A1%B0\" aria-label=\"참조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참조</h1>\n<ul>\n<li><a href=\"https://blog.sessionstack.com/how-javascript-works-event-loop-and-the-rise-of-async-programming-5-ways-to-better-coding-with-2f077c4438b5\">https://blog.sessionstack.com/how-javascript-works-event-loop-and-the-rise-of-async-programming-5-ways-to-better-coding-with-2f077c4438b5</a></li>\n<li><a href=\"https://meetup.toast.com/posts/89\">https://meetup.toast.com/posts/89</a></li>\n<li><a href=\"https://bit.ly/3An9y0K\">https://bit.ly/3An9y0K</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=8aGhZQkoFbQ\">https://www.youtube.com/watch?v=8aGhZQkoFbQ</a></li>\n</ul>","frontmatter":{"title":"[JS] 이벤트 루프","date":"April 13, 2022"}}},"pageContext":{"slug":"/JavaScript/eventloop/","previous":{"fields":{"slug":"/React/react-setup-jest/"},"frontmatter":{"title":"밑바닥부터 React 개발 환경 구축하기 - 4. Jest와 Testing-Library"}},"next":{"fields":{"slug":"/React/next-setup-allinone/"},"frontmatter":{"title":"밑바닥부터 Next.js 개발 환경 구축하기 - All in One"}}}}}